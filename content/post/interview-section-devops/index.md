---
title: Вопросы и ответы для собеседования по теме "DevOps и деплой"
slug: interview-section-devops
date: 2022-02-17T11:13:55Z
expirydate: 2024-08-18T11:13:55Z
image: cover.png
categories: [dev]
tags: [interview, network]
---

_WIP_

<!--more-->

{{< table_of_contents >}}

## Что такое Blue/Green deployment?

Стратегия Blue/Green развертывания _(иногда ее ещё называют red/black)_ предусматривает одновременное развертывание старой (зеленой) и новой (синей) версий приложения.

После размещения обеих версий обычные пользователи получают доступ к зеленой, в то время как синяя доступна для QA-команды для автоматизации тестов через отдельный сервис или прямой проброс портов. После того как синяя (новая) версия была протестирована и был одобрен ее релиз, сервис переключается на неё, а зеленая (старая) сворачивается.

На практике это означает то, что в одну единицу времени существует **два production окружения**. Один (первый) их них обрабатывает запросы в данный момент, второй - условно простаивает. В момент деплоя обновляется ПО на втором окружении, проверяется корректность его работы, и трафик единомоменто (с помощью впереди стоящего роутера) переключается с первого на второй. Первый таким образом освобождается для следующего обновления (но стоит заметить, что сразу его "гасить" часто нельзя, так как могут существовать транзакции, которые будут требовать своего завершения).

Из преимуществ такого подхода при деплое - это возможность быстрого отката до предыдущего состояния, и наличие "горячего" резерва.

С **базами данных** при таком подходе часто бывают проблемы, особенно если нужно менять их логические структуры для поддержки новой версии софта. Хитрость тут в том, чтобы разделить деплой изменения логических структур и обновление приложения. Для этого:

- Сначала нужно применить рефакторинг базы данных, чтобы изменить структуры для поддержки **новой и старой** версий приложения
- Задеплоить эти изменения, проверить, что всё хорошо работает, и у нас есть версия предыдущего состояния
- Только после этого задеплоить новую версию приложения
- Когда обновления уже устаканились, удалить поддержку базы данных для старой версии

> Что можно почитать:
> - [Сине-зеленый деплой](https://habr.com/ru/post/309832/)

## Что такое Canary deployment?

> Золотоискатели и шахтеры брали канареек (птички такие) на добычу - пока канарейки поют, можно работать, если замолчали - в шахте газ и пора уходить. Шахтеры жертвовали маленькой птичкой, чтобы выбираться из шахт живыми.

Канареечные деплои похожи на сине-зеленые (Blue/Green), но лучше управляются и используют прогрессивный поэтапный подход. К этому типу относятся несколько различных стратегий, включая "скрытые" запуски и А/В-тестирование.

Эта стратегия применяется, когда необходимо испытать некую новую функциональность, как правило, в бэкенде приложения. Суть подхода в том, чтобы создать два практически одинаковых сервера - один обслуживает почти всех пользователей, а другой, с новыми функциями, обслуживает лишь небольшую подгруппу пользователей, после чего результаты их работы сравниваются.
Если все проходит без ошибок (канарейка выживает), новая версия постепенно выкатывается на всю инфраструктуру (или весь трафик переключается на новую версию).

{{< youtube GWH13lIvy0U >}}

## Что такое Dark (скрытые) или А/В-развертывания?

Скрытое развертывание — еще одна вариация канареечной стратегии. Разница между скрытым и канареечным развертыванием состоит в том, что скрытые развертывания имеют дело с фронтендом, а не с бэкендом, как канареечные.

Другое название этих развертываний — А/В-тестирование. Вместо того чтобы открыть доступ к новой функции всем пользователям, ее предлагают лишь ограниченной их части. Обычно эти пользователи не знают, что выступают тестерами-первопроходцами (отсюда и термин "скрытое развертывание").

С помощью переключателей функциональности (`feature toggles`) и других инструментов можно следить за тем, как пользователи взаимодействуют с новой функцией, увлекает ли она их или они считают новый пользовательский интерфейс запутанным, и другими типами метрик.

## Какие Devops тулзы можно использовать для кейса?

_WIP_

## Как бы был устроен деплой для этого кейса?

_WIP_
